<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share Your Wish</title>
    <link rel="stylesheet" href="css/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container" style="max-width: 900px;">
        <h1>Share Your Wish</h1>
        <p>Condividi i desideri che vuoi mettere nel cassetto oppure pescane uno a caso tra quelli degli altri. Tutto viene salvato nel tuo browser e puoi cancellarlo quando vuoi dalla sezione di amministrazione.</p>

        <div class="button-group" style="margin-top: 1rem;">
            <button id="shareViewBtn">Share your wish</button>
            <button id="readViewBtn">Read a random wish</button>
        </div>

        <section id="shareSection" class="card" style="display: none;">
            <h2>Invia un desiderio</h2>
            <p>Scrivi il tuo messaggio e aggiungilo al vaso dei desideri.</p>
            <div class="form-group">
                <label for="wishInput">Il tuo desiderio</label>
                <textarea id="wishInput" rows="5" placeholder="Scrivi qui il tuo desiderio"></textarea>
            </div>
            <button id="submitWishBtn">Invia</button>
            <p id="shareFeedback" class="footer-text" style="text-align: left; margin-top: 1rem;"></p>
        </section>

        <section id="readSection" class="card" style="display: none;">
            <h2>Leggi un desiderio casuale</h2>
            <p>Premi il pulsante per pescare un desiderio tra quelli inviati.</p>
            <button id="randomWishBtn">Pesca un desiderio</button>
            <div id="randomWishDisplay" class="card" style="display: none; margin-top: 1rem; background-color: #f9fafb;"></div>
            <p id="readFeedback" class="footer-text" style="text-align: left; margin-top: 1rem;"></p>
        </section>

        <section id="adminSection" class="card" style="margin-top: 2rem;">
            <h3>Amministrazione locale</h3>
            <p class="footer-text" style="text-align: left;">I desideri vengono salvati nel <strong>localStorage</strong> del browser. Usa il pulsante seguente per cancellarli tutti.</p>
            <div class="stats-container" style="margin: 1rem 0;">
                <div class="stat-box">
                    <p>Desideri salvati</p>
                    <h2 id="wishCount">0</h2>
                </div>
            </div>
            <button id="clearWishesBtn" class="delete-btn">Pulisci tutti i desideri</button>
            <p id="adminFeedback" class="footer-text" style="text-align: left; margin-top: 1rem;"></p>
        </section>
    </div>

    <script>
        const STORAGE_KEY = 'shareYourWishList';

        const shareSection = document.getElementById('shareSection');
        const readSection = document.getElementById('readSection');
        const shareViewBtn = document.getElementById('shareViewBtn');
        const readViewBtn = document.getElementById('readViewBtn');
        const submitWishBtn = document.getElementById('submitWishBtn');
        const randomWishBtn = document.getElementById('randomWishBtn');
        const clearWishesBtn = document.getElementById('clearWishesBtn');

        const wishInput = document.getElementById('wishInput');
        const shareFeedback = document.getElementById('shareFeedback');
        const randomWishDisplay = document.getElementById('randomWishDisplay');
        const readFeedback = document.getElementById('readFeedback');
        const adminFeedback = document.getElementById('adminFeedback');
        const wishCount = document.getElementById('wishCount');

        function loadWishes() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (!stored) return [];
            try {
                const parsed = JSON.parse(stored);
                return Array.isArray(parsed) ? parsed : [];
            } catch (err) {
                console.warn('Errore di parsing localStorage', err);
                return [];
            }
        }

        function saveWishes(wishes) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(wishes));
            wishCount.textContent = wishes.length;
        }

        function updateCount() {
            wishCount.textContent = loadWishes().length;
        }

        function switchView(view) {
            shareSection.style.display = view === 'share' ? 'block' : 'none';
            readSection.style.display = view === 'read' ? 'block' : 'none';
            shareFeedback.textContent = '';
            readFeedback.textContent = '';
        }

        function showMessage(element, message, isError = false) {
            element.textContent = message;
            element.style.color = isError ? '#b91c1c' : '#065f46';
        }

        shareViewBtn.addEventListener('click', () => switchView('share'));
        readViewBtn.addEventListener('click', () => switchView('read'));

        submitWishBtn.addEventListener('click', () => {
            const text = wishInput.value.trim();
            if (!text) {
                showMessage(shareFeedback, 'Inserisci un desiderio prima di inviare.', true);
                return;
            }

            const wishes = loadWishes();
            wishes.push({ text, createdAt: new Date().toISOString() });
            saveWishes(wishes);
            showMessage(shareFeedback, 'Desiderio aggiunto con successo!');
            wishInput.value = '';
        });

        randomWishBtn.addEventListener('click', () => {
            const wishes = loadWishes();
            if (!wishes.length) {
                randomWishDisplay.style.display = 'none';
                showMessage(readFeedback, 'Non ci sono desideri salvati: aggiungine uno prima.', true);
                return;
            }

            const randomIndex = Math.floor(Math.random() * wishes.length);
            const wish = wishes[randomIndex];
            randomWishDisplay.textContent = wish.text;
            randomWishDisplay.style.display = 'block';
            showMessage(readFeedback, 'Ecco un desiderio scelto a caso.');
        });

        clearWishesBtn.addEventListener('click', () => {
            const wishes = loadWishes();
            if (!wishes.length) {
                showMessage(adminFeedback, 'Non ci sono desideri da eliminare.');
                return;
            }
            const confirmDelete = confirm('Vuoi davvero cancellare tutti i desideri salvati nel browser?');
            if (!confirmDelete) return;
            localStorage.removeItem(STORAGE_KEY);
            randomWishDisplay.style.display = 'none';
            wishInput.value = '';
            updateCount();
            showMessage(adminFeedback, 'Tutti i desideri sono stati rimossi dal browser.');
        });

        document.addEventListener('DOMContentLoaded', () => {
            updateCount();
            switchView('share');
        });
    </script>
</body>
</html>
