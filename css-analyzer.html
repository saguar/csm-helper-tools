<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Customer Success Score Analyzer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: light;
      --bg: #f8fafc;
      --surface: #ffffff;
      --surface-alt: #f1f5f9;
      --primary: #0ea5e9;
      --success: #15803d;
      --warning: #b45309;
      --danger: #b91c1c;
      --text: #0f172a;
      --muted: #64748b;
      --border: rgba(148, 163, 184, 0.35);
      --shadow: 0 24px 48px rgba(15, 23, 42, 0.12);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    body {
      background: linear-gradient(160deg, #e2e8f0, #f8fafc 45%, #ffffff 100%);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 4rem;
    }

    .page-header {
      padding: 3rem 5vw 1.5rem;
      display: grid;
      gap: 1.5rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .page-header h1 {
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 700;
    }

    .page-header p {
      color: var(--muted);
      max-width: 900px;
      line-height: 1.6;
    }

    .reference-month {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.95rem;
      color: var(--muted);
    }

    main {
      padding: 0 5vw;
      display: grid;
      gap: 2.5rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .panel {
      background: var(--surface);
      border-radius: 1.25rem;
      padding: 1.75rem;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }

    .panel h2 {
      font-size: 1.35rem;
      margin-bottom: 1rem;
      color: var(--text);
    }

    .data-loader {
      display: grid;
      gap: 1.25rem;
    }

    .form-grid {
      display: grid;
      gap: 1.25rem;
    }

    @media (min-width: 720px) {
      .form-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
        align-items: end;
      }
    }

    .form-group {
      display: grid;
      gap: 0.5rem;
    }

    .form-group label {
      font-weight: 600;
      color: var(--text);
    }

    .form-group select,
    .form-group input[type="file"] {
      background: var(--surface-alt);
      border: 1px solid var(--border);
      border-radius: 0.85rem;
      padding: 0.65rem 1rem;
      color: var(--text);
      font-size: 0.95rem;
    }

    .load-button {
      justify-self: start;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 10px 25px rgba(14, 165, 233, 0.25);
    }

    .load-button:disabled {
      background: var(--surface-alt);
      color: var(--muted);
      cursor: not-allowed;
      box-shadow: none;
    }

    .helper-text {
      font-size: 0.85rem;
      color: var(--muted);
      line-height: 1.5;
    }

    .grid-3 {
      display: grid;
      gap: 1.5rem;
    }

    @media (min-width: 900px) {
      .grid-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .key-metric {
      border-radius: 1rem;
      padding: 1.5rem;
      border: 1px solid var(--border);
      background: linear-gradient(160deg, rgba(14, 165, 233, 0.12), rgba(148, 163, 184, 0.08));
      display: grid;
      gap: 0.75rem;
    }

    .key-metric h3 {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .key-metric strong {
      display: block;
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--text);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.85rem;
      padding: 0.35rem 0.65rem;
      border-radius: 999px;
      font-weight: 600;
      color: var(--text);
      background: rgba(148, 163, 184, 0.18);
      white-space: nowrap;
    }

    .badge.up {
      color: var(--success);
      background: rgba(21, 128, 61, 0.12);
    }

    .badge.down {
      color: var(--danger);
      background: rgba(185, 28, 28, 0.12);
    }

    .overview-grid {
      display: grid;
      gap: 1rem;
    }

    @media (min-width: 720px) {
      .overview-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .overview-card {
      border-radius: 1rem;
      padding: 1.25rem;
      background: var(--surface-alt);
      border: 1px solid var(--border);
      display: grid;
      gap: 0.65rem;
    }

    .overview-card strong {
      font-size: 1.8rem;
      font-weight: 600;
      color: var(--text);
    }

    .signal-list {
      display: grid;
      gap: 1rem;
    }

    .signal-item {
      padding: 1rem;
      border-radius: 1rem;
      border: 1px solid var(--border);
      background: var(--surface-alt);
      display: grid;
      gap: 0.35rem;
    }

    .signal-item header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 1rem;
      margin-bottom: 0.25rem;
    }

    .signal-item h4 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
    }

    .category-deck {
      display: grid;
      gap: 1.5rem;
    }

    .category-card {
      border-radius: 1.25rem;
      border: 1px solid var(--border);
      background: var(--surface-alt);
      padding: 1.5rem;
      display: grid;
      gap: 1.25rem;
    }

    .category-headline {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      justify-content: space-between;
      align-items: center;
    }

    .capability {
      border-radius: 1rem;
      padding: 1.25rem;
      border: 1px solid var(--border);
      background: var(--surface);
      display: grid;
      gap: 1rem;
    }

    .signals {
      display: grid;
      gap: 0.75rem;
    }

    .signal-chip {
      display: grid;
      gap: 0.35rem;
      padding: 0.85rem;
      border-radius: 0.85rem;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: var(--surface-alt);
    }

    .signal-chip span {
      color: var(--muted);
      font-size: 0.85rem;
    }

    .signal-chip strong {
      font-size: 1.05rem;
      color: var(--text);
    }

    .score-pill {
      justify-self: flex-start;
      padding: 0.25rem 0.65rem;
      border-radius: 999px;
      font-size: 0.78rem;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .score-high {
      background: rgba(21, 128, 61, 0.15);
      color: var(--success);
    }

    .score-medium {
      background: rgba(234, 179, 8, 0.18);
      color: #b45309;
    }

    .score-low {
      background: rgba(185, 28, 28, 0.15);
      color: var(--danger);
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .filters input,
    .filters select {
      background: var(--surface-alt);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 0.6rem 1rem;
      color: var(--text);
      min-width: 200px;
      font-size: 0.95rem;
    }

    .filters input::placeholder {
      color: var(--muted);
    }

    .empty-state {
      padding: 1rem;
      color: var(--muted);
      font-style: italic;
    }

    @media (max-width: 640px) {
      .page-header,
      main {
        padding-left: 1.25rem;
        padding-right: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <header class="page-header">
    <div>
      <h1>Customer Success Score Analyzer</h1>
      <p>
        Explore key metrics, trends, and scored signals for your customer success score. Upload a JSON export, set the reference month,
        and use the interactive filters to uncover opportunities and risks faster.
      </p>
    </div>
    <div class="reference-month">Reference month: <strong id="selectedMonth">Not selected</strong></div>
  </header>
  <main>
    <section class="panel" id="dataLoaderPanel">
      <h2>Load customer success score</h2>
      <div class="data-loader">
        <div class="form-grid">
          <div class="form-group">
            <label for="referenceMonth">Reference month</label>
            <select id="referenceMonth">
              <option value="" disabled selected>-- Select reference month --</option>
              <option value="January">January</option>
              <option value="February">February</option>
              <option value="March">March</option>
              <option value="April">April</option>
              <option value="May">May</option>
              <option value="June">June</option>
              <option value="July">July</option>
              <option value="August">August</option>
              <option value="September">September</option>
              <option value="October">October</option>
              <option value="November">November</option>
              <option value="December">December</option>
            </select>
          </div>
          <div class="form-group">
            <label for="scoreUpload">Upload score JSON</label>
            <input type="file" id="scoreUpload" accept=".json,application/json">
          </div>
        </div>
        <button class="load-button" type="button" id="loadScoreBtn" disabled>Load score</button>
        <p class="helper-text">
          Upload a JSON file exported from Customer Success Score. The file is not sent anywhere; parsing happens in your browser. The
          selected reference month will be displayed alongside the loaded score, similar to the License Visualizer tool.
        </p>
      </div>
    </section>

    <section class="panel" id="account-overview">
      <h2>Account overview</h2>
      <div class="grid-3" id="accountCards"></div>
    </section>

    <section class="panel" id="overall-performance">
      <h2>Overall performance</h2>
      <div class="overview-grid" id="overviewGrid"></div>
    </section>

    <section class="panel" id="trends">
      <div class="filters">
        <input type="search" id="signalSearch" placeholder="Search a signal..." />
        <select id="trendFilter">
          <option value="all">Trend: all</option>
          <option value="up">Only improving</option>
          <option value="down">Only declining</option>
        </select>
        <select id="categoryFilter">
          <option value="all">Category: all</option>
        </select>
      </div>
      <div class="grid-3" style="margin-top: 1.5rem;" id="trendColumns">
        <div>
          <h3>Trending up</h3>
          <div class="signal-list" id="trendingUp"></div>
        </div>
        <div>
          <h3>Trending down</h3>
          <div class="signal-list" id="trendingDown"></div>
        </div>
        <div>
          <h3>Warnings / At risk</h3>
          <div class="signal-list" id="lowSignals"></div>
        </div>
      </div>
    </section>

    <section class="panel" id="all-scored-signals">
      <h2>All scored signals</h2>
      <p class="helper-text">Every scored signal from the JSON file is listed below and respects the filters above.</p>
      <div class="signal-list" id="allSignalsList"></div>
    </section>

    <section class="panel" id="categories">
      <h2>Category analysis</h2>
      <div class="category-deck" id="categoryDeck"></div>
    </section>
  </main>

  <template id="signalTemplate">
    <article class="signal-item">
      <header>
        <h4 data-field="signal"></h4>
        <span class="badge" data-field="change"></span>
      </header>
      <p data-field="category" style="color: var(--muted);"></p>
      <div style="display:flex; align-items:center; gap:0.75rem; margin-top:0.25rem;">
        <strong data-field="score"></strong>
        <span class="badge" data-field="rating"></span>
      </div>
    </article>
  </template>

  <script>
    const scoreClass = (score) => {
      if (score >= 80) return 'score-high';
      if (score >= 50) return 'score-medium';
      return 'score-low';
    };

    const formatScore = (score) => (typeof score === 'number' ? `${score}` : score ?? '-');

    const createScoreBadge = (score) => {
      const span = document.createElement('span');
      span.className = `score-pill ${scoreClass(score)}`;
      span.textContent = `Score ${formatScore(score)}`;
      return span;
    };

    const createOverviewCard = (title, score, extra) => {
      const card = document.createElement('article');
      card.className = 'overview-card';
      const h3 = document.createElement('h3');
      h3.textContent = title;
      const strong = document.createElement('strong');
      strong.textContent = formatScore(score);
      card.append(h3, strong);
      if (extra) {
        const span = document.createElement('span');
        span.className = 'badge';
        span.textContent = extra;
        card.appendChild(span);
      }
      return card;
    };

    const populateSignalList = (signals, container) => {
      container.innerHTML = '';
      if (!signals.length) {
        const empty = document.createElement('p');
        empty.className = 'empty-state';
        empty.textContent = 'No signals match the current filters.';
        container.appendChild(empty);
        return;
      }

      for (const item of signals) {
        const clone = document.getElementById('signalTemplate').content.firstElementChild.cloneNode(true);
        clone.querySelector('[data-field="signal"]').textContent = item.signal;
        clone.querySelector('[data-field="category"]').textContent = item.categoryDescription || item.category || '';
        const changeSpan = clone.querySelector('[data-field="change"]');
        if (item.change) {
          changeSpan.textContent = item.change;
          changeSpan.classList.add(item.change.includes('↑') ? 'up' : item.change.includes('↓') ? 'down' : '');
        } else {
          changeSpan.remove();
        }
        const scoreElement = clone.querySelector('[data-field="score"]');
        scoreElement.textContent = formatScore(item.score ?? '-');
        const ratingBadge = clone.querySelector('[data-field="rating"]');
        if (item.rating) {
          ratingBadge.textContent = item.rating;
        } else {
          ratingBadge.remove();
        }
        container.appendChild(clone);
      }
    };

    const buildCategoryDeck = (categories) => {
      const deck = document.getElementById('categoryDeck');
      deck.innerHTML = '';

      for (const category of categories) {
        const categoryCard = document.createElement('article');
        categoryCard.className = 'category-card';

        const headline = document.createElement('div');
        headline.className = 'category-headline';
        const title = document.createElement('h3');
        title.textContent = category.name;
        const badge = document.createElement('span');
        badge.className = 'badge';
        badge.textContent = category.rating || 'N/A';
        headline.append(title, badge, createScoreBadge(category.score));
        categoryCard.appendChild(headline);

        if (category.change) {
          const change = document.createElement('span');
          change.className = `badge ${category.change.includes('↑') ? 'up' : category.change.includes('↓') ? 'down' : ''}`;
          change.textContent = `Trend ${category.change}`;
          categoryCard.appendChild(change);
        }

        for (const capability of category.capabilities || []) {
          const capabilityBlock = document.createElement('section');
          capabilityBlock.className = 'capability';
          const heading = document.createElement('div');
          heading.style.display = 'flex';
          heading.style.justifyContent = 'space-between';
          heading.style.alignItems = 'center';
          heading.style.gap = '0.75rem';

          const name = document.createElement('h4');
          name.textContent = capability.name;
          name.style.fontSize = '1.1rem';
          name.style.color = 'var(--text)';
          const capabilityBadge = capability.rating ? document.createElement('span') : null;
          if (capabilityBadge) {
            capabilityBadge.className = 'badge';
            capabilityBadge.textContent = capability.rating;
          }
          heading.appendChild(name);
          if (capabilityBadge) heading.appendChild(capabilityBadge);
          heading.appendChild(createScoreBadge(capability.score));
          capabilityBlock.appendChild(heading);

          if (capability.scoreChange) {
            const change = document.createElement('span');
            change.className = `badge ${capability.scoreChange.includes('↑') ? 'up' : capability.scoreChange.includes('↓') ? 'down' : ''}`;
            change.textContent = `Score change ${capability.scoreChange}`;
            capabilityBlock.appendChild(change);
          }

          if ((capability.scoredSignals || []).length) {
            const signals = document.createElement('div');
            signals.className = 'signals';
            for (const signal of capability.scoredSignals) {
              const chip = document.createElement('div');
              chip.className = 'signal-chip';
              const signalName = document.createElement('strong');
              signalName.textContent = signal.signal;
              const signalScore = document.createElement('span');
              signalScore.textContent = `Score: ${formatScore(signal.score)}${signal.scoreChange ? ` • Change ${signal.scoreChange}` : ''}`;
              chip.append(signalName, signalScore);
              signals.appendChild(chip);
            }
            capabilityBlock.appendChild(signals);
          }

          categoryCard.appendChild(capabilityBlock);
        }

        deck.appendChild(categoryCard);
      }
    };

    const extractLowSignals = (categories) => {
      const lowSignals = [];
      for (const category of categories) {
        for (const capability of category.capabilities || []) {
          for (const signal of capability.scoredSignals || []) {
            if (signal.score !== undefined && signal.score < 50) {
              lowSignals.push({
                category: `${category.name} / ${capability.name}`,
                categoryDescription: `${category.name} • ${capability.name}`,
                signal: signal.signal,
                score: signal.score,
                change: signal.scoreChange,
                rating: signal.rating,
              });
            }
          }
        }
      }
      return lowSignals;
    };

    const buildAllScoredSignals = (categories, trendingUp = [], trendingDown = []) => {
      const signalMap = new Map();

      const upsertSignal = (entry) => {
        if (!entry?.signal) return;
        const categoryKey = entry.category ?? entry.categoryDescription ?? '';
        const key = `${categoryKey.toLowerCase()}::${entry.signal.toLowerCase()}`;
        const existing = signalMap.get(key) || {};
        signalMap.set(key, {
          category: existing.category || entry.category || entry.categoryDescription || '',
          categoryDescription: existing.categoryDescription || entry.categoryDescription || entry.category || '',
          signal: existing.signal || entry.signal,
          score: existing.score ?? entry.score,
          change: existing.change ?? entry.change,
          rating: existing.rating ?? entry.rating,
        });
      };

      for (const category of categories) {
        for (const capability of category.capabilities || []) {
          for (const signal of capability.scoredSignals || []) {
            upsertSignal({
              category: category.name,
              categoryDescription: `${category.name} • ${capability.name}`,
              signal: signal.signal,
              score: signal.score,
              change: signal.scoreChange,
              rating: signal.rating,
            });
          }
        }
      }

      const appendTrending = (list) => {
        for (const signal of list) {
          upsertSignal({
            category: signal.category,
            categoryDescription: signal.category,
            signal: signal.signal,
            score: signal.score,
            change: signal.change,
            rating: signal.rating,
          });
        }
      };

      appendTrending(trendingUp);
      appendTrending(trendingDown);

      return Array.from(signalMap.values());
    };

    const populateAccountCards = (account, tenant, overview, referenceMonth) => {
      const container = document.getElementById('accountCards');
      container.innerHTML = '';

      const cards = [
        { title: 'Account', main: account?.name ?? 'N/A', subtitle: account?.id },
        { title: 'Tenant', main: tenant?.name ?? 'N/A', subtitle: tenant?.id },
        { title: 'Customer Success Score', main: overview?.overallScore?.score ?? 'N/A', subtitle: overview?.overallScore?.rating }
      ];

      if (referenceMonth) {
        cards.push({ title: 'Reference Month', main: referenceMonth });
      }

      for (const { title, main, subtitle } of cards) {
        const card = document.createElement('article');
        card.className = 'key-metric';
        const h3 = document.createElement('h3');
        h3.textContent = title;
        const strong = document.createElement('strong');
        strong.textContent = formatScore(main);
        card.append(h3, strong);
        if (subtitle) {
          const span = document.createElement('span');
          span.className = 'badge';
          span.textContent = subtitle;
          card.appendChild(span);
        }
        container.appendChild(card);
      }
    };

    const populateOverview = (overview) => {
      const grid = document.getElementById('overviewGrid');
      grid.innerHTML = '';
      grid.appendChild(createOverviewCard('Product adoption', overview.productAdoption?.score, overview.productAdoption?.change));
      grid.appendChild(createOverviewCard('Customer expertise', overview.customerExpertise?.score, overview.customerExpertise?.change));
      grid.appendChild(createOverviewCard('Technical health', overview.technicalHealth?.score, overview.technicalHealth?.change));
    };

    const selectedMonthLabel = document.getElementById('selectedMonth');
    const referenceMonthSelect = document.getElementById('referenceMonth');
    const scoreUploadInput = document.getElementById('scoreUpload');
    const loadScoreBtn = document.getElementById('loadScoreBtn');

    let currentTrendData = null;
    let allScoredSignals = [];

    const categoryFilter = document.getElementById('categoryFilter');

    const resetDashboard = () => {
      currentTrendData = null;
      allScoredSignals = [];
      selectedMonthLabel.textContent = 'Not selected';
      document.getElementById('accountCards').innerHTML = '';
      document.getElementById('overviewGrid').innerHTML = '';
      document.getElementById('categoryDeck').innerHTML = '<p class="empty-state">Upload a JSON file to view category insights.</p>';
      const emptyTrendMessage = '<p class="empty-state">Upload a JSON file to begin the analysis.</p>';
      document.getElementById('trendingUp').innerHTML = emptyTrendMessage;
      document.getElementById('trendingDown').innerHTML = emptyTrendMessage;
      document.getElementById('lowSignals').innerHTML = emptyTrendMessage;
      document.getElementById('allSignalsList').innerHTML = '<p class="empty-state">Upload a JSON file to list all scored signals.</p>';
      categoryFilter.innerHTML = '<option value="all">Category: all</option>';
      categoryFilter.value = 'all';
      referenceMonthSelect.selectedIndex = 0;
      scoreUploadInput.value = '';
      loadScoreBtn.disabled = true;
    };

    const populateCategoryOptions = (categories) => {
      const uniqueCategories = Array.from(new Set(categories)).sort();
      categoryFilter.innerHTML = '<option value="all">Category: all</option>';
      categoryFilter.value = 'all';
      for (const name of uniqueCategories) {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        categoryFilter.appendChild(option);
      }
    };

    const applyFilters = () => {
      if (!currentTrendData) return;
      const searchTerm = document.getElementById('signalSearch').value.toLowerCase();
      const trendFilterValue = document.getElementById('trendFilter').value;
      const categoryValue = categoryFilter.value;

      const matchesFilters = (signal) => {
        const matchesSearch = !searchTerm || signal.signal?.toLowerCase().includes(searchTerm);
        const matchesCategory = categoryValue === 'all' || signal.category === categoryValue || signal.categoryDescription?.startsWith(`${categoryValue}`);
        return matchesSearch && matchesCategory;
      };

      const trendingUpFiltered = trendFilterValue !== 'down' ? currentTrendData.trendingUp.filter(matchesFilters) : [];
      const trendingDownFiltered = trendFilterValue !== 'up' ? currentTrendData.trendingDown.filter(matchesFilters) : [];
      const lowSignalsFiltered = currentTrendData.lowSignals.filter(matchesFilters);
      const allSignalsFiltered = allScoredSignals.filter(matchesFilters);

      populateSignalList(trendingUpFiltered, document.getElementById('trendingUp'));
      populateSignalList(trendingDownFiltered, document.getElementById('trendingDown'));
      populateSignalList(lowSignalsFiltered, document.getElementById('lowSignals'));
      populateSignalList(allSignalsFiltered, document.getElementById('allSignalsList'));
    };

    const refreshDashboard = (data, referenceMonthText = '') => {
      try {
        const overview = data.overview?.tenantOverview || {};
        const categories = data.overview?.categories || [];
        const trendingUp = data.overview?.trendingSignals?.trendingUp || [];
        const trendingDown = data.overview?.trendingSignals?.trendingDown || [];

        populateAccountCards(data.account || {}, data.tenant || {}, { overallScore: overview.overallScore }, referenceMonthText);
        populateOverview({
          productAdoption: overview.productAdoption || {},
          customerExpertise: overview.customerExpertise || {},
          technicalHealth: overview.technicalHealth || {},
        });
        buildCategoryDeck(categories);

        currentTrendData = {
          trendingUp,
          trendingDown,
          lowSignals: extractLowSignals(categories),
        };
        allScoredSignals = buildAllScoredSignals(categories, trendingUp, trendingDown);

        const categoryNames = [
          ...allScoredSignals.map((signal) => signal.category),
          ...currentTrendData.lowSignals.map((signal) => signal.category),
        ].filter(Boolean);
        populateCategoryOptions(categoryNames);
        applyFilters();
      } catch (error) {
        console.error('Unable to render dashboard', error);
        document.querySelector('main').innerHTML = '<p class="empty-state">Unable to render the Customer Success Score dashboard. Check the JSON file structure.</p>';
      }
    };

    const updateLoadButtonState = () => {
      loadScoreBtn.disabled = !(referenceMonthSelect.value && scoreUploadInput.files.length);
    };

    referenceMonthSelect.addEventListener('change', updateLoadButtonState);
    scoreUploadInput.addEventListener('change', updateLoadButtonState);

    loadScoreBtn.addEventListener('click', () => {
      const file = scoreUploadInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const parsed = JSON.parse(event.target.result);
          const month = referenceMonthSelect.value;
          selectedMonthLabel.textContent = month || 'Not selected';
          refreshDashboard(parsed, month);
        } catch (error) {
          console.error('Invalid JSON file', error);
          alert('The uploaded file is not a valid JSON structure.');
        }
      };
      reader.readAsText(file);
    });

    document.getElementById('signalSearch').addEventListener('input', applyFilters);
    document.getElementById('trendFilter').addEventListener('change', applyFilters);
    categoryFilter.addEventListener('change', applyFilters);

    resetDashboard();
  </script>
</body>
</html>
